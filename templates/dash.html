<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>

    <style>
     main {
       width: max-content;
       min-width: 65rem;
     }
     section + section {
       margin-top: 1.0rem;
     }
     h1 {
       display: inline-block;
       font-size: 1.75rem;
       margin-top: 0.5rem;
       margin-bottom: 1.0rem;
     }
     h2 {
       display: inline-block;
       font-size: 1.375rem;
       margin-top: 1.0rem;
       margin-bottom: 0.5rem;
     }
     h2:first-child {
       margin-top: 0.5rem;
     }
     .updated {
       display: block;
       float: right;
       margin-top: 0.8rem;
     }
     .updated button {
       margin-left: 0.8rem;
       padding: 0.2rem 0.8rem;
     }
     .updated button[value="pause_upd"] {
       display: inline;
     }
     .updated button[value="resume_upd"],
     .updated button[value="restart_upd"] {
       display: none;
     }
     table {
       margin-top: 1.0rem;
       border: 2px solid darkgrey;
       border-collapse: collapse;
     }
     th, td {
       border: 1px solid darkgrey;
       border-collapse: collapse;
       padding: 0.75rem;
       text-align: center;
     }
     .score {
       width: 1.0rem;
     }
     .hor_sect {
       border-bottom: 2px solid darkgrey;
     }
     .vert_sect {
       border-left: 2px solid darkgrey;
     }
     .plyr_lbl,
     .team_lbl {
       text-align: left;
       width: 10rem;
     }
     .pt_picks {
       display: flex;
       flex-direction: row;
     }
     .avail {
       display: inline-block;
       margin-top: 0.0rem;
       margin-left: 1.0rem;
       margin-right: 1.5rem;
       width: 20rem;
     }
     .avail div {
       display: flex;
       flex-flow: column wrap;
       height: 40rem;
       border-right: 1px solid;
     }
     .picks {
       display: inline-block;
       margin-top: 0.0rem;
       margin-left: 1.5rem;
       min-width: 30rem;
     }
     .picks div {
       display: flex;
       flex-direction: column;
     }
     .picks .notes {
       margin-top: 0.8rem;
     }
     .sect_hdr {
       font-weight: bold;
       font-size: 1.25rem;
     }
     .verb {
       margin: 0.0rem 0.5rem;
     }
     .avail p {
       margin: 0.3rem 0.0rem;
     }
     .picks p {
       margin: 0.3rem 0.0rem;
     }
     .pick .player {
       display: inline-block;
       min-width: 10rem;
       padding: 0.2rem 0.5rem;
       background-color: #F0F0F0;
     }
     .pick .info {
       display: inline-block;
       min-width: 15rem;
       padding: 0.2rem 0.5rem;
       background-color: #F0F0F0;
     }
     .pick.new .player,
     .pick.new .info {
       font-weight: bold;
       color: #108810;
     }
     .active .player {
       font-weight: bold;
       border: 1px solid #D70000;
     }
     b {
       font-weight: bold;
     }
     u {
       text-decoration: solid underline 1px;
     }
     .red_bg {
       background-color: #FFECEC;
     }
     .grn_bg {
       background-color: #E1FFDC;
     }
     .red_fg {
       color: #D70000;
     }
     .grn_fg {
       color: #108810;
     }
    </style>
  </head>

  <body>
    <main>
      <h1>{{tourn.name}} &ndash; {{title}}</h1>
      <input class="start" type="hidden" name="start" value="">
      <span class="updated">
        Updated: {{updated}} (<span class="elapsed">0 secs ago</span>)
        <button value="pause_upd">Pause Updates</button>
        <button value="resume_upd">Resume Updates</button>
        <button value="restart_upd">Restart Updates</button>
      </span>

      {% if dash_num == 0 %}
      <section class="sd_scores">
        <table>
          <thead>
            <tr>
              <th class="plyr_lbl hor_sect" rowspan="2">Player (by Player Num)</th>
              <th class="hor_sect" rowspan="2">Wins</th>
              <th class="hor_sect" rowspan=2>Losses</th>
              <th class="hor_sect vert_sect" colspan="{{rnds}}">Points For (by Round)</th>
              <th class="hor_sect vert_sect" colspan="{{rnds}}">Points Against (by Round)</th>
              <th class="hor_sect vert_sect" colspan="3">Overall</th>
              <th class="hor_sect vert_sect" rowspan=2>Rank</th>
              <th class="hor_sect" rowspan=2>Mvmt</th>
            </tr>
            <tr>
              <th class="hor_sect vert_sect score">1</th>
              {% for rnd in range(2, rnds + 1) %}
              <th class="hor_sect score">{{rnd}}</th>
              {% endfor %}
              <th class="hor_sect vert_sect score">1</th>
              {% for rnd in range(2, rnds + 1) %}
              <th class="hor_sect score">{{rnd}}</th>
              {% endfor %}
              <th class="hor_sect vert_sect">Win Pct</th>
              <th class="hor_sect">Pos</th>
              <th class="hor_sect">Pts Pct</th>
            </tr>
          </thead>
          <tbody>
            {% for pl in players %}
            <tr class="{{colcls[pl.player_num]}}">
              <td class="plyr_lbl">{{pl.player_tag|safe}}</td>
              <td class="tally"><img {{win_tallies[pl.player_num]|safe}} /></td>
              <td class="tally"><img {{loss_tallies[pl.player_num]|safe}} /></td>
              <td class="vert_sect">{{pts_for[pl.player_num].get(1, '')|safe}}</td>
              {% for rnd in range(2, rnds + 1) %}
              <td class="">{{pts_for[pl.player_num].get(rnd, '')|safe}}</td>
              {% endfor %}
              <td class="vert_sect">{{pts_against[pl.player_num].get(1, '')|safe}}</td>
              {% for rnd in range(2, rnds + 1) %}
              <td class="">{{pts_against[pl.player_num].get(rnd, '')|safe}}</td>
              {% endfor %}
              <td class="vert_sect">{{stats_fmt[pl.player_num][0]|safe}}</td>
              <td class="">{{stats_fmt[pl.player_num][1]|safe}}</td>
              <td class="">{{stats_fmt[pl.player_num][2]|safe}}</td>
              <td class="vert_sect">{{stats_fmt[pl.player_num][3]|safe}}</td>
              <td class="">{{mvmt[pl.player_num]}}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
      {% endif %}  {# dash_num == 0 #}

      {% if dash_num == 1 %}
      {% for div in div_list %}
      <section class="rr_scores">
        <h2>Division {{div}}</h2>
        <table>
          <thead>
            <tr>
              <th class="plyr_lbl hor_sect" rowspan="2">Team (by Div Seed)</th>
              <th class="hor_sect" rowspan="2">Wins</th>
              <th class="hor_sect" rowspan=2>Losses</th>
              <th class="hor_sect vert_sect" colspan="{{rnds}}">Points For (by Round)</th>
              <th class="hor_sect vert_sect" colspan="{{rnds}}">Points Against (by Round)</th>
              <th class="hor_sect vert_sect" colspan="3">Overall</th>
              <th class="hor_sect vert_sect" colspan="2">Head-to-Head</th>
              <th class="hor_sect vert_sect" rowspan=2>Rank</th>
              <th class="hor_sect" rowspan=2>Mvmt</th>
            </tr>
            <tr>
              <th class="hor_sect vert_sect score">1</th>
              {% for rnd in range(2, rnds + 1) %}
              <th class="hor_sect score">{{rnd}}</th>
              {% endfor %}
              <th class="hor_sect vert_sect score">1</th>
              {% for rnd in range(2, rnds + 1) %}
              <th class="hor_sect score">{{rnd}}</th>
              {% endfor %}
              <th class="hor_sect vert_sect">Win Pct</th>
              <th class="hor_sect">Pos</th>
              <th class="hor_sect">Pts Pct</th>
              <th class="hor_sect vert_sect">W-L</th>
              <th class="hor_sect">Pts Pct</th>
            </tr>
          </thead>
          <tbody>
            {% for tm in div_teams[div] %}
            <tr class="{{colcls[tm.id]}}">
              <td class="team_lbl">{{tm.team_tag|safe}}</td>
              <td class="tally"><img {{win_tallies[tm.id]|safe}} /></td>
              <td class="tally"><img {{loss_tallies[tm.id]|safe}} /></td>
              <td class="vert_sect">{{pts_for[tm.id].get(1, '')|safe}}</td>
              {% for rnd in range(2, rnds + 1) %}
              <td class="">{{pts_for[tm.id].get(rnd, '')|safe}}</td>
              {% endfor %}
              <td class="vert_sect">{{pts_against[tm.id].get(1, '')|safe}}</td>
              {% for rnd in range(2, rnds + 1) %}
              <td class="">{{pts_against[tm.id].get(rnd, '')|safe}}</td>
              {% endfor %}
              <td class="vert_sect">{{stats_fmt[tm.id][0]|safe}}</td>
              <td class="">{{stats_fmt[tm.id][1]|safe}}</td>
              <td class="">{{stats_fmt[tm.id][2]|safe}}</td>
              <td class="vert_sect">{{stats_fmt[tm.id][3]|safe}}</td>
              <td class="">{{stats_fmt[tm.id][4]|safe}}</td>
              <td class="vert_sect">{{stats_fmt[tm.id][5]|safe}}</td>
              <td class="">{{mvmt[tm.id]}}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
      {% endfor %}
      {% endif %}  {# dash_num == 1 #}

      {% if dash_num == 2 %}
      <section class="pt_picks">
        <section class="avail">
          <p>
            <span class="sect_hdr">Available</span>
            <i>(by rank)</i>
          </p>
          <div>
            {% for pl in picks_avail %}
            <p class="player">
              {{pl.seed_ident}}
            </p>
            {% endfor %}
            {% if not picks_avail %}
            <i>None</i>
            {% endif %}
          </div>
        </section>
        <section class="picks">
          <p>
            <span class="sect_hdr">Picks</span>
          </p>
          <div>
            {% for pl in picks_made %}
            {% set pick_cls = " new" if loop.index > prev_count else "" %}
            <p class="pick{{pick_cls}}">
              <span class="player">
                {% set champ_flg = "*" if pl.reigning_champ else "" %}
                {{pl.seed_ident}}{{champ_flg|safe}}
              </span>
              <span class="verb">
                picks
              </span>
              <span class="info">
                {{pl.picks_info}}
              </span>
            </p>
            {% endfor %}  {# pl in picks_made #}
            {% if cur_pick %}
            <p class="pick active">
              <span class="player">
                {{cur_pick.seed_ident}}
              </span>
              <span class="verb">
                has the current pick
              </span>
            </p>
            {% endif %}  {# cur_pick #}
            <p class="notes">
              * indicates reigning champs
            </p>
          </div>
        </section>
      </section>
      {% endif %}  {# dash_num == 2 #}
    </main>
  </body>

  <script src="/static/jquery-3.7.1.min.js"></script>
  <script>
   $(function() {
     // document ready
     let paused = false;
     let done = {{'true' if done else 'false'}};
     let intervalId;
     let timeoutId;

     function updElapsed(startVal) {
       const nowVal = Math.round(Date.now() / 1000.0);
       const elapsed = nowVal - startVal
       $(".elapsed").text(elapsed + " secs ago");
     };

     function startElapsed() {
       const $start = $("input.start");
       if (!$start.val()) {
         $start.val(Math.round(Date.now() / 1000.0));
       }
       intervalId = setInterval(updElapsed, 1000, $start.val());
     };

     $("button[value='pause_upd']").on('click', function() {
       paused = true;
       if (timeoutId) {
         window.clearTimeout(timeoutId);
         timeoutId = null;
       }
       if (intervalId) {
         window.clearInterval(intervalId);
         intervalId = null;
       }
       $(this).css('display', 'none');
       $("button[value='resume_upd']").css('display', 'inline');
       $(".elapsed").text("paused");
     });

     $("button[value='resume_upd']").on('click', function() {
       paused = false;
       $(this).css('display', 'none');
       $("button[value='pause_upd']").css('display', 'inline');
       window.setTimeout(function() {
         window.location.reload();
       }, 1000);
       $(".elapsed").text("resuming");
     });

     $("button[value='restart_upd']").on('click', function() {
       paused = false;
       done = false;
       $(this).css('display', 'none');
       $("button[value='pause_upd']").css('display', 'inline');
       window.setTimeout(function() {
         window.location.reload();
       }, 1000);
       $(".elapsed").text("restarting");
     });

     {% if done %}
     $("button[value='pause_upd']").css('display', 'none');
     $("button[value='restart_upd']").css('display', 'inline');
     $(".elapsed").text("done");
     {% else %}
     startElapsed();
     {% endif %}
     if (!paused && !done) {
       timeoutId = window.setTimeout(function() {
         window.location.reload();
       }, {{update_int}});
     }
   });
  </script>
</html>
