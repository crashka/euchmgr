<!DOCTYPE html>
<html>
  <head>
    <title>{{title}}</title>
    <style>
     .winner {
       color: #108810;
       font-weight: bold;
     }
     .loser {
       color: #D70000;
     }
     .no_table {
       margin-top: 1.0rem;
       display: block;
       font-size: 1.125rem;
       font-style: italic;
     }
     .division {
       margin-top: 1.0rem;
       margin-bottom: 0.5rem;
       display: flex;
       flex-direction: column;
     }
     .cohort {
       padding-left: 1.5rem;
       margin-top: 0.75rem;
       margin-bottom: 0.5rem;
       display: flex;
       flex-direction: column;
     }
     .cohort > p {
       font-size: 1.25rem;
       margin-top: 0.5rem;
       margin-bottom: 0.0rem;
     }
     .cohort > p > span {
       font-weight: bold;
     }
     .cohort ul {
       list-style: square outside none;
       font-size: 1.25rem;
       margin-top: 0.25rem;
       margin-bottom: 0.0rem;
     }
     .team,
     .player {
       padding-left: 1.5rem;
       margin-top: 0.75rem;
       margin-bottom: 0.5rem;
     }
     .team > p > span,
     .player > p > span {
       margin-right: 1.0rem;
       font-weight: bold;
     }
     h1 {
       font-size: 2.0rem;
       margin-block-start: 1.0rem;
       margin-block-end: 0.0rem;
     }
     h2 {
       font-size: 1.75rem;
       margin-block-start: 1.0rem;
       margin-block-end: 0.0rem;
     }
     h3 {
       font-size: 1.5rem;
       margin-block-start: 0.75rem;
       margin-block-end: 0.5rem;
       display: inline-block;
     }
     .h3_info {
       font-size: 1.25rem;
       font-weight: normal;
     }
     h4 {
       font-size: 1.25rem;
       margin-block-start: 0.75rem;
       margin-block-end: 0.5rem;
       /*display: inline-block;*/
     }
     p {
       margin-block-start: 0.0rem;
       margin-block-end: 0.0rem;
       display: inline;
     }
     table {
       border: 2px solid darkgrey;
       border-collapse: collapse;
       margin-top: 0.5rem;
     }
     th, td {
       border: 1px solid darkgrey;
       border-collapse: collapse;
       padding: 0.25rem 0.50rem;
       text-align: center;
     }
    </style>
  </head>

  <body>
    <h1>{{tourn.name}} &ndash; {{title}}</h1>

    {% if report_num == 0 %}
    <article class="seeding">
      <h2>All Players</h2>
      {% for pos, cohort in pos_rpt.items() %}
      <article class="cohort">
        <h3>Position {{pos}}&nbsp;&nbsp;<span class="h3_info">({{pos_info[pos]}})</span></h3>
        {% for player, games in cohort.items() %}
        {% if loop.first %}
        <p>{{len(cohort)}} players tied: {{', '.join(pos_cohort[pos])}}</p>
        {% endif %}
        <article class="player">
          <h4>{{player.nick_name}} ({{player.player_num}})</h4>
          <p>
            TB Rank: <span>{{player.player_rank}}</span>
            Win-Loss: <span>{{player.tb_data['wins']}}-{{player.tb_data['losses']}}</span>
            PF-PA: <span>{{player.tb_data['pts_for']}}-{{player.tb_data['pts_against']}}</span>
            Pts Pct (total): <span>{{round(player.seed_pts_pct, 2)}}%</span>
          </p>
          {% if len(games) > 0 %}
          <table>
            <thead>
              <tr>
                {% if report_by == "team" %}
                <th>Round</th>
                <th>Team</th>
                <th>Opponent</th>
                <th>Team Pts</th>
                <th>Opp Pts</th>
                {% elif report_by == "winner" %}
                <th>Round</th>
                <th>Winner</th>
                <th>Loser</th>
                <th>Winner Pts</th>
                <th>Loser Pts</th>
                {% else %}
                <th>Round</th>
                <th>Player 1</th>
                <th>Player 2</th>
                <th>Player 1 Pts</th>
                <th>Player 2 Pts</th>
                {% endif %}
              </tr>
            </thead>
            <tbody>
              {% for game in games %}
              <tr class="{{'winner' if game.is_winner(player) else 'loser'}}">
                {% if report_by == 'team' %}
                <td>{{game.round_num}}</td>
                <td>{{game.team_info(player)[0]}}</td>
                <td>{{game.opp_info(player)[0]}}</td>
                <td>{{game.team_info(player)[1]}}</td>
                <td>{{game.opp_info(player)[1]}}</td>
                {% elif report_by == 'winner' %}
                <td>{{game.round_num}}</td>
                <td>{{game.winner_info[0]}}</td>
                <td>{{game.loser_info[0]}}</td>
                <td>{{game.winner_info[2]}}</td>
                <td>{{game.loser_info[2]}}</td>
                {% else %}
                <td>{{game.round_num}}</td>
                <td>{{game.team1_name}}</td>
                <td>{{game.team2_name}}</td>
                <td>{{game.team1_pts}}</td>
                <td>{{game.team2_pts}}</td>
                {% endif %}
              </tr>
              {% endfor %}  {# game #}
            </tbody>
          </table>
          {% else %}
          <p class="no_table">No head-to-head games played</p>
          {% endif %}
        </article>
        {% endfor %}  {# player #}
      </article>
      {% endfor %}  {# pos #}
    </article>
    {% endif %}  {# report_num == 0 #}

    {% if report_num == 1 %}
    {% for div, cohorts in div_rpt.items() %}
    <article class="division">
      <h2>Division {{div}}</h2>
      {% for pos, cohort in cohorts.items() %}
      <article class="cohort">
        <h3>Position {{pos}}&nbsp;&nbsp;<span class="h3_info">({{div_info[div][pos]}})</span></h3>
        {% for team, games in cohort.items() %}
        {% if loop.first %}
        <p>[<b>{{len(cohort)}} teams tied</b>] {{'; '.join(div_cohort[div][pos])}}</p>

        {% if div_elevs[div][pos] %}
        <p>Head-to-Head Wins (for ranking) [{{len(div_elevs[div][pos])}}]:</p>
        <ul>
          {% for tm, opp in div_elevs[div][pos] %}
          <li>{{tm.team_name}} ({{tm.div_seed}}) beats {{opp.team_name}} ({{opp.div_seed}})</li>
          {% endfor %}
        </ul>
        {% endif %}  {# div_elevs #}

        {% if div_win_grps[div][pos] %}
        <p>Cyclic Win Groups (head-to-head wins offset) [{{len(div_win_grps[div][pos])}}]:</p>
        <ul>
          {% for grp in div_win_grps[div][pos] %}
          <li>[<b>{{concat_seeds(grp)}}</b>] {{concat_teams(grp)}}</li>
          {% endfor %}
        </ul>
        {% endif %}  {# div_win_grps #}

        {% if div_idents[div][pos] %}
        <p>Identical Tie-Breakers [{{len(div_idents[div][pos])}}]:</p>
        <ul>
          {% for equals in div_idents[div][pos] %}
          <li>[<b>{{concat_seeds(equals)}}</b>] {{concat_teams(equals)}}</li>
          {% endfor %}
        </ul>
        {% endif %}  {# div_idents #}
        {% endif %}  {# loop.first #}

        <article class="team">
          <h4>{{team.team_name}} ({{team.div_seed}})</h4>
          <p>
            TB Rank: <span>{{team.div_rank}}</span>
            Win-Loss: <span>{{team.tb_data['wins']}}-{{team.tb_data['losses']}}</span>
            PF-PA: <span>{{team.tb_data['pts_for']}}-{{team.tb_data['pts_against']}}</span>
            Pts Pct (total): <span>{{round(team.tourn_pts_pct, 2)}}%</span>
          </p>
          <table>
            <thead>
              <tr>
                {% if report_by == "team" %}
                <th>Round</th>
                <th>Team</th>
                <th>Opponent</th>
                <th>Team Pts</th>
                <th>Opp Pts</th>
                {% elif report_by == "winner" %}
                <th>Round</th>
                <th>Winner</th>
                <th>Loser</th>
                <th>Winner Pts</th>
                <th>Loser Pts</th>
                {% else %}
                <th>Round</th>
                <th>Team 1</th>
                <th>Team 2</th>
                <th>Team 1 Pts</th>
                <th>Team 2 Pts</th>
                {% endif %}
              </tr>
            </thead>
            <tbody>
              {% for game in games %}
              <tr class="{{'winner' if game.is_winner(team) else 'loser'}}">
                {% if report_by == 'team' %}
                <td>{{game.round_num}}</td>
                <td>{{game.team_info(team)[0]}} ({{game.team_info(team)[1]}})</td>
                <td>{{game.opp_info(team)[0]}} ({{game.opp_info(team)[1]}})</td>
                <td>{{game.team_info(team)[2]}}</td>
                <td>{{game.opp_info(team)[2]}}</td>
                {% elif report_by == 'winner' %}
                <td>{{game.round_num}}</td>
                <td>{{game.winner_info[0]}} ({{game.winner_info[1]}})</td>
                <td>{{game.loser_info[0]}} ({{game.loser_info[1]}})</td>
                <td>{{game.winner_info[2]}}</td>
                <td>{{game.loser_info[2]}}</td>
                {% else %}
                <td>{{game.round_num}}</td>
                <td>{{game.team1_name}} ({{game.team1_div_seed}})</td>
                <td>{{game.team2_name}} ({{game.team2_div_seed}})</td>
                <td>{{game.team1_pts}}</td>
                <td>{{game.team2_pts}}</td>
                {% endif %}
              </tr>
              {% endfor %}  {# game #}
            </tbody>
          </table>
        </article>
        {% endfor %}  {# team #}
      </article>
      {% endfor %}  {# pos #}
    </article>
    {% endfor %}  {# div #}
    {% endif %}  {# report_num == 1 #}
  </body>
</html>
