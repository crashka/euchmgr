<!DOCTYPE html>
<html>
  <head>
    <title>{{title}}</title>

    <style>
     .winner {
       color: #108810;
       font-weight: bold;
     }
     .loser {
       color: #D70000;
     }
     .division {
       margin-top: 0.0rem;
       margin-bottom: 0.0rem;
       display: flex;
       flex-direction: column;
     }
     .cohort {
       padding-left: 1.5rem;
       margin-top: 0.0rem;
       margin-bottom: 0.0rem;
       display: flex;
       flex-direction: column;
     }
     .cohort > p {
       font-size: 1.125rem;
       margin-top: 0.5rem;
       margin-bottom: 0.0rem;
     }
     .cohort > p > span {
       font-weight: bold;
     }
     .cohort ul {
       list-style: square outside none;
       font-size: 1.125rem;
       margin-top: 0.25rem;
       margin-bottom: 0.0rem;
     }
     .team {
       padding-left: 1.5rem;
       margin-top: 0.5rem;
       /*margin-bottom: 0.5rem;*/
     }
     .team > p > span {
       margin-right: 1.0rem;
       font-weight: bold;
     }
     h1 {
       font-size: 1.75rem;
       margin-top: 0.5rem;
       margin-bottom: 0.5rem;
     }
     h2 {
       font-size: 1.5rem;
       margin-top: 1.75rem;
       margin-bottom: 0.5rem;
     }
     .division:first-of-type h2 {
       margin-top: 0.75rem;
     }
     h3 {
       display: inline-block;
       font-size: 1.375rem;
       margin-top: 1.0rem;
       margin-bottom: 0.375rem;
     }
     .cohort:first-of-type h3 {
       margin-top: 0.5rem;
     }
     .h3_info {
       font-size: 1.125rem;
       font-weight: normal;
     }
     h4 {
       font-size: 1.125rem;
       margin-top: 0.75rem;
       margin-bottom: 0.5rem;
     }
     .team:first-of-type h4 {
       margin-top: 0.5rem;
     }
     p {
       margin-block-start: 0.0rem;
       margin-block-end: 0.0rem;
       display: inline;
     }
     table {
       border: 2px solid darkgrey;
       border-collapse: collapse;
       margin-top: 0.5rem;
     }
     th, td {
       border: 1px solid darkgrey;
       border-collapse: collapse;
       padding: 0.25rem 0.50rem;
       text-align: center;
     }
    </style>
  </head>

  <body>
    <h1>{{tourn.name}} &ndash; {{title}}</h1>

    {% if report_num == 0 %}
    {% for div, cohorts in div_rpt.items() %}
    <article class="division">
      <h2>Division {{div}}</h2>
      {% for pos, cohort in cohorts.items() %}
      <article class="cohort">
        <h3>Position {{pos}}&nbsp;&nbsp;<span class="h3_info">({{div_info[div][pos]}})</span></h3>
        {% for team, games in cohort.items() %}
        {% if loop.first %}
        <p>[<b>{{len(cohort)}} teams tied</b>] {{'; '.join(div_cohort[div][pos])}}</p>

        {% if div_elevs[div][pos] %}
        <p>Head-to-Head Wins (for ranking) [{{len(div_elevs[div][pos])}}]:</p>
        <ul>
          {% for tm, opp in div_elevs[div][pos] %}
          <li>{{tm.team_name}} [{{tm.div_seed}}] beats {{opp.team_name}} [{{opp.div_seed}}]</li>
          {% endfor %}
        </ul>
        {% endif %}  {# div_elevs #}

        {% if div_win_grps[div][pos] %}
        <p>Cyclic Win Groups (head-to-head wins offset) [{{len(div_win_grps[div][pos])}}]:</p>
        <ul>
          {% for grp in div_win_grps[div][pos] %}
          <li>[<b>{{concat_seeds(grp)}}</b>] {{concat_teams(grp)}}</li>
          {% endfor %}
        </ul>
        {% endif %}  {# div_win_grps #}

        {% if div_idents[div][pos] %}
        <p>Identical Tie-Breakers [{{len(div_idents[div][pos])}}]:</p>
        <ul>
          {% for equals in div_idents[div][pos] %}
          <li>[<b>{{concat_seeds(equals)}}</b>] {{concat_teams(equals)}}</li>
          {% endfor %}
        </ul>
        {% endif %}  {# div_idents #}
        {% endif %}  {# loop.first #}

        <article class="team">
          <h4>{{team.team_name}} [{{team.div_seed}}]</h4>
          <p>
            TB Rank: <span>{{team.div_rank}}</span>
            Win-Loss: <span>{{team.div_tb_data['wins']}}-{{team.div_tb_data['losses']}}</span>
            PF-PA: <span>{{team.div_tb_data['pts_for']}}-{{team.div_tb_data['pts_against']}}</span>
            Pts Pct (total): <span>{{round(team.tourn_pts_pct, 2)}}%</span>
          </p>
          <table>
            <thead>
              <tr>
                {% if report_by == "team" %}
                <th>Round</th>
                <th>Team</th>
                <th>Opponent</th>
                <th>Team Pts</th>
                <th>Opp Pts</th>
                {% elif report_by == "winner" %}
                <th>Round</th>
                <th>Winner</th>
                <th>Loser</th>
                <th>Winner Pts</th>
                <th>Loser Pts</th>
                {% else %}
                <th>Round</th>
                <th>Team 1</th>
                <th>Team 2</th>
                <th>Team 1 Pts</th>
                <th>Team 2 Pts</th>
                {% endif %}
              </tr>
            </thead>
            <tbody>
              {% for game in games %}
              <tr class="{{'winner' if game.is_winner(team) else 'loser'}}">
                {% if report_by == 'team' %}
                <td>{{game.round_num}}</td>
                <td>{{game.team_info(team)[0]}} [{{game.team_info(team)[1]}}]</td>
                <td>{{game.opp_info(team)[0]}} [{{game.opp_info(team)[1]}}]</td>
                <td>{{game.team_info(team)[2]}}</td>
                <td>{{game.opp_info(team)[2]}}</td>
                {% elif report_by == 'winner' %}
                <td>{{game.round_num}}</td>
                <td>{{game.winner_info[0]}} [{{game.winner_info[1]}}]</td>
                <td>{{game.loser_info[0]}} [{{game.loser_info[1]}}]</td>
                <td>{{game.winner_info[2]}}</td>
                <td>{{game.loser_info[2]}}</td>
                {% else %}
                <td>{{game.round_num}}</td>
                <td>{{game.team1_name}} [{{game.team1_div_seed}}]</td>
                <td>{{game.team2_name}} [{{game.team2_div_seed}}]</td>
                <td>{{game.team1_pts}}</td>
                <td>{{game.team2_pts}}</td>
                {% endif %}
              </tr>
              {% endfor %}  {# game #}
            </tbody>
          </table>
        </article>
        {% endfor %}  {# team #}
      </article>
      {% endfor %}  {# pos #}
    </article>
    {% endfor %}  {# div #}
    {% endif %}  {# report_num == 0 #}
  </body>
</html>
