<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>

    <style>
     body {
       width: max-content;
       min-width: 80rem;
     }
     header {
       padding: 0.80rem 0.0rem;
     }
     header select {
       margin-left: 0.3rem;
       padding: 0.15rem 0.25rem;
     }
     h2 {
       margin-top: 0.5rem;
     }
     .err_dlg {
       padding: 1.1rem 1.4rem;
     }
     .err_dlg div {
       width: 22rem;
       color: #D10000;
       overflow: auto;
     }
     .err_dlg button {
       margin-top: 1.2rem;
     }
     form {
       display: inline-block;
     }
     .sel_tourn {
       width: 12rem;
     }
     .login_info {
       float: right;
       text-align: right;
       /*margin-right: 1.0rem;*/
       /*padding: 0.5rem 0.0rem;*/
     }
     .login_info span {
       font-weight: bold;
       color: mediumblue;
       cursor: pointer;
     }
     .tourn label {
       display: inline-block;
       min-width: 10.0rem;
       text-align: right;
     }
     .tourn input {
       margin-left: 0.3rem;
       padding: 0.15rem 0.25rem;
     }
     .tourn input[readonly] {
       border: thin solid grey;
       background-color: #F0F0F0;
     }
     .tourn input[type="text"] {
       width: 12rem;
     }
     .tourn input[type="number"] {
       width: 3rem;
     }
     .actions {
       padding-top: 1.5rem;
     }
     .actions button {
       margin-right: 0.8rem;
       padding: 0.2rem 0.8rem;
     }
     .actions a {
       margin-right: 0.5rem;
       /* padding: 0.2rem 0.2rem; */
     }
    </style>
  </head>

  <body>
    <dialog class="err_dlg">
      <div></div>
      <button autofocus>Close</button>
    </dialog>
    <header>
      <form action="/tourn" method="post">
        <input type="hidden" name="submit_func" value="select_tourn">
        <label>Select tournament:</label>
        <select name="tourn" class="sel_tourn" onchange="this.form.submit();">
          {% if new_tourn %}
          {% for tourn_name in tourn_sel %}
          {% set selected = " selected" if tourn_name == sel_new else "" %}
          {% set disabled = " disabled" if tourn_name == sel_sep else "" %}
          <option value="{{tourn_name}}"{{selected}}{{disabled}}>{{tourn_name}}</option>
          {% endfor %}

          {% elif tourn %}
          {% for tourn_name in tourn_sel %}
          {% set selected = " selected" if tourn_name == tourn.name else "" %}
          {% set disabled = " disabled" if tourn_name == sel_sep else "" %}
          <option value="{{tourn_name}}"{{selected}}{{disabled}}>{{tourn_name}}</option>
          {% endfor %}

          {% else %}
          <option value="" disabled selected hidden></option>
          {% for tourn_name in tourn_sel %}
          {% set disabled = " disabled" if tourn_name == sel_sep else "" %}
          <option value="{{tourn_name}}"{{disabled}}>{{tourn_name}}</option>
          {% endfor %}
          {% endif %}
        </select>
      </form>
      <span class="login_info">
        {% with tooltip = "Click here to exit admin mode" %}
        Logged in as: <span title='{{tooltip}}'>{{user.name}}</span>
        [<a href='/logout'>Logout</a>]
        {% endwith %}
      </span>
    </header>
    {% if tourn %}
    <section class="tourn">
      {% set new = "New " if new_tourn else "" %}
      <h2>{{new}}Tournament Info</h2>
      <form action="/tourn" method="post" enctype="multipart/form-data">
        {% set disabled = "" if new_tourn else " disabled" %}
        <input type="hidden" name="tourn_id" value="{{tourn.id}}">
        <p>
          <label>Name</label>:
          {% set hlp_msg = "required (must be unique)" %}
          {% set attrs = "required autofocus" if new_tourn else "readonly" %}
          <input name="tourn_name" type="text" value="{{tourn.name or ''}}"
                 placeholder="{{hlp_msg}}" {{attrs}}>
        </p>
        <p>
          <label>Dates</label>:
          <input name="dates" type="text" value="{{tourn.dates or ''}}"{{disabled}}>
        </p>
        <p>
          <label>Venue</label>:
          <input name="venue" type="text" value="{{tourn.venue or ''}}"{{disabled}}>
        </p>
        <p>
          <label>Rounds (seed)</label>:
          <input name="seed_rounds" type="number" value="{{tourn.seed_rounds}}" disabled>
        </p>
        <p>
          <label>Rounds (tourn)</label>:
          <input name="tourn_rounds" type="number" value="{{tourn.tourn_rounds}}" disabled>
        </p>
        <p>
          <label>Divisions (tourn)</label>:
          <input name="divisions" type="number" value="{{tourn.divisions}}" disabled>
        </p>
        <p>
          <label>Upload Roster File</label>:
          <input name="roster_file" type="file" value="" accept=".csv"{{disabled}}>
        </p>
        <p>
          <label>Overwrite Existing</label>:
          {% set checked = " checked" if overwrite else "" %}
          <input type="checkbox" name="overwrite" value="yes"{{checked}}{{disabled}}>
        </p>
        <p class="actions">
          <button class="submit" value="{{buttons[1]}}"{{btn_attr[1]}}>{{btn_lbl[1]}}</button>
          {% if not new_tourn  %}
          <button class="submit" value="{{buttons[2]}}"{{btn_attr[2]}}>{{btn_lbl[2]}}</button>
          <a class="cancel" href="./">[cancel]</a>
          {% endif %}
        </p>
      </form>
    </section>
    {% endif %}  {# tourn #}
  </body>

  <script src="/static/jquery-3.7.1.min.js"></script>
  <script>
   $(function() {
     // add css and attributes
     $(".submit").attr({
       type: 'submit',
       name: "submit_func"
     });

     // shortcuts (navigation)
     $('.login_info span').on('click', function() {
       window.location.href = "./";
     });

     // error dialog
     $('.err_dlg button').on('click', function() {
       $('.err_dlg')[0].close();
     });
     const show_error = function(err_text) {
       $('.err_dlg div').html(err_text);
       $('.err_dlg')[0].showModal();
     };

     {% if err_msg %}
     show_error('{{err_msg|safe}}');
     {% endif %}
   });
  </script>
</html>
